<template>
	<div>
		<el-button type="primary" @click="getaaa()  " style="margin-bottom: 20px;">è§¦å‘ä¸€ä¸ªäº‹ä»¶ æˆ‘æƒ³çœ‹çœ‹æ•ˆæœ</el-button>

		<el-button type="primary" @click="getbbbb()  " style="margin-bottom: 20px;">å¼‚æ­¥æ“ä½œ</el-button>

		<el-button type="primary" @click="openDB('å¸…å“¥å»ºçš„æ•°æ®åº“','person','1')" style="margin-bottom: 20px;">ç”Ÿæˆæ•°æ®åº“</el-button>

		<el-button type="primary" @click=" add('person', {name: 'æ¬§é˜³éœ¸å¤©', age: '5', sex: 'ç”·'})  " style="margin-bottom: 20px;">æ–°å¢å€¼</el-button>

		<el-button type="primary" @click="get('person')  " style="margin-bottom: 20px;">è·å–æ•°æ®</el-button>

		<el-button type="primary" @click="foreach('person')  " style="margin-bottom: 20px;">éå†æ•°æ®</el-button>

		<el-button type="primary" @click="update('person',  {name: 'ä¼Šè‰èé€æ˜Ÿ', age: '100', sex: 'å¥³'})  " style="margin-bottom: 20px;">æ›´æ–°æ•°æ®</el-button>

		<el-button type="primary" @click="remove('person', 2)" style="margin-bottom: 20px;">åˆ é™¤æ•°æ®</el-button>

		<el-button type="primary" @click="searchFromIndex('person', 'name', 'ä¼Šè‰èé€æ˜Ÿ')" style="margin-bottom: 20px;">æ ¹æ®ç´¢å¼•æŸ¥æ•°æ®</el-button>


		<div class="aaa"></div>
		333
		<div class="imgsa">
			1222

		</div>
		<!-- <img src="../../staticFile/img/threejs65tree.png" />
		<img src="../../staticFile/img/timg.jpg" /> -->
	</div>
</template>

<script>
	export default {


		data() {
			return {
				db: '',
				request: '', //æ•°æ®åº“
			}
		},
		methods: {
			add(objectStoreName, argument) {
				console.log(objectStoreName, argument, '3333');


				console.log(this.db, 'ï¼ï¼ï¼ï¼ï¼ï¼')
				if (this.db != null) {
					console.log(this.db)

					// æ‰§è¡Œäº‹åŠ¡ï¼Œæ·»åŠ æ•°æ®åˆ°å¯¹è±¡ä»“åº“ï¼ˆè¡¨ï¼‰
					var request = this.db.transaction([objectStoreName], 'readwrite')
						.objectStore(objectStoreName)
						.add(argument);

					request.onsuccess = function(event) {
						console.log('æ•°æ®å†™å…¥æˆåŠŸ');
					};

					request.onerror = function(event) {
						console.log('æ•°æ®å†™å…¥å¤±è´¥');

					}
				}
			},

			getbbbb() {

				// 	let promise = new Promise(function(resolve, reject) {
				// 	  console.log('Promise');
				// 	    reject('å•Šå•Šå•Šå•Š');
				// 	});

				// 	promise.then(function() {
				// 	  console.log('resolved.æˆåŠŸ');
				// 	}).catch(function(aaa){
				// 		console.log(aaa,'æˆ‘æ˜¯å¤±è´¥çš„æ–¹æ³•');
				// 	}).finally(() => {	
				// 		console.log('è¿™æ˜¯æ— è®ºå¦‚ä½•éƒ½è¦æ‰§è¡Œçš„');
				// 	});

				var A = new Promise((resolve, reject) => {

					setTimeout(function() {
						console.log('111111');
						 resolve();
					}, 1500);


				})
				var B = new Promise((resolve, reject) => {
					setTimeout(function() {
						console.log('222222');
						 resolve();
					}, 500);

				})
				var C = new Promise((resolve, reject) => {
					setTimeout(function() {
						console.log('3333333');
						reject();
					}, 2000);

				})

				const D = Promise.race([A, B, C]).then(function() {
					console.log('æˆåŠŸäº†');
				}).catch(function() {
					console.log('å¤±è´¥äº†');
				}).finally(function(){
					console.log('æˆ‘æ— è®ºå¦‚ä½•éƒ½ä¼šæ‰§è¡Œ');
				})







			},

			getaaa(x, z = 'æˆ‘éƒ½å‘Šåˆ«åœ°æ–¹éƒ½æ˜¯') {
				var [a, b, c] = [1, 2, 3];
				var [head, ...content] = [1, 2, 3, 1, 45, 55]
				var [def = 'aaa'] = [];

				var [x, y] = ['aaa', 'bbbb'];
				[x, y] = [y, x];
				var {
					length: len
				} = 'å•æ‰€å‘å¤§æ°´èŒƒå¾·è¨å‘è¾¾'
				var {
					a = '333', b
				} = {
					b: [1, 2]
				}

				var aabb = [1, 2, 3, 4, 5, 6].copyWithin(1, 4, 4)

				var fills = ['a', 'vb', 'c'].fill('7')

				var includs = ['a0', '2', 'c'].includes('2a');

				var aaaas = ['a', 'b', ['c', 'd', ['e', 'f', 'g', ['h']]]].flat(3);

				var avb = {
					a: 2333,
					b: "dfsdfåå€’æ˜¯"
				}
				var ab = {
					c: 'æ‰“å‘å£«å¤§å¤«',
					d: 666
				}

				var ccc = { ...ab,
					...avb
				}

				var ass = { ..."hello"
				}

				var sets = [1, 1, 1, 2, 2, 3, 3, 4, 5, 5, 6, 6, 7, 7, 7, 7]

				var arrays = Array.from('233333', (item) => {
					return item * 2
				});

				let obj = {
					['h' + 'ello']() {
						return 'hi';
					}
				};

				let arr = [3, 5, 2, 2, 5, 5];
				let unique = new Set(arr);

				var setsss = [...new Set(unique)];
				console.log(setsss, 'æˆ‘æ˜¯å½“å‰è¾“å‡ºçš„å€¼');

			},

			get(objectStoreName) {
				if (this.db != null) {
					console.log(this.db)

					// æ‰§è¡Œäº‹åŠ¡ï¼Œä»å¯¹è±¡ä»“åº“ï¼ˆè¡¨ï¼‰ä¸­è·å–æ‰€æœ‰æ•°æ®
					var request = this.db.transaction([objectStoreName], 'readwrite')
						.objectStore(objectStoreName).getAll()

					// æ•°æ®è·å–å¤±è´¥
					request.onerror = function(event) {
						console.log('äº‹åŠ¡å¤±è´¥')
					}

					//æ•°æ®è·å–æˆåŠŸ
					request.onsuccess = function(event) {
						if (request.result) {
							// æ‰“å°æ‰€æœ‰æ•°æ®
							console.log(request.result)
						} else {
							console.log('æœªè·å¾—æ•°æ®è®°å½•')
						}
					};
				}
			},

			// å¯¹è±¡ä»“åº“ï¼ˆè¡¨åï¼‰
			foreach(objectStoreName) {
				var this_ = this;
				if (this_.db != null) {
					console.log(this_.db, '^^^^^^')

					// æ‰§è¡Œäº‹åŠ¡ï¼Œä»å¯¹è±¡ä»“åº“ï¼ˆè¡¨ï¼‰ä¸­è·å–æ‰€æœ‰æ•°æ®
					var request = this_.db.transaction([objectStoreName], 'readwrite')
						.objectStore(objectStoreName).openCursor()

					// æ•°æ®è·å–å¤±è´¥
					request.onerror = function(event) {
						console.log('äº‹åŠ¡å¤±è´¥')
					}

					//æ•°æ®è·å–æˆåŠŸ
					request.onsuccess = function(event) {
						console.log(event, request, '3333')
						let cursor = request.result
						if (cursor) {
							// éå†æ‰“å°æ‰€æœ‰æ•°æ®
							console.log(cursor)
							console.log(cursor.key)
							console.log(cursor.value.name)
							console.log(cursor.value.age)
							console.log(cursor.value.sex)
							cursor.continue()
						} else {
							console.log('æœªè·å¾—æ•°æ®è®°å½•')
						}
					};
				}
			},

			update(objectStoreName, argument) {
				console.log(objectStoreName, argument, 'ğŸ±ğŸ±ğŸ±ğŸ±');
				var this_ = this;
				if (this_.db != null) {
					console.log(this_.db)

					// æ‰§è¡Œäº‹åŠ¡ï¼Œæ·»åŠ æ•°æ®åˆ°å¯¹è±¡ä»“åº“ï¼ˆè¡¨ï¼‰
					var request = this_.db.transaction([objectStoreName], 'readwrite')
						.objectStore(objectStoreName)
						.put(argument);

					request.onsuccess = function(event) {
						console.log('æ•°æ®æ›´æ–°æˆåŠŸ');
					};

					request.onerror = function(event) {
						console.log('æ•°æ®æ›´æ–°å¤±è´¥');
					}
				}
			},

			// åˆ é™¤æ•°æ®(è‹¥æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œåˆ é™¤æ“ä½œ)
			// å¯¹è±¡ä»“åº“ï¼ˆè¡¨åï¼‰
			remove(objectStoreName, index) {
				var this_ = this;
				if (this_.db != null) {
					console.log(this_.db)

					// æ‰§è¡Œäº‹åŠ¡ï¼Œä»å¯¹è±¡ä»“åº“ï¼ˆè¡¨ï¼‰ä¸­è·å–æ‰€æœ‰æ•°æ®
					var request = this_.db.transaction([objectStoreName], 'readwrite')
						.objectStore(objectStoreName).delete(index)


					console.log(request, objectStoreName, index, '44444444');
					// æ•°æ®è·å–å¤±è´¥
					request.onerror = function(event) {
						console.log('äº‹åŠ¡å¤±è´¥')
					}

					//æ•°æ®è·å–æˆåŠŸ
					request.onsuccess = function(event) {
						if (request.result) {
							// éå†æ‰“å°æ‰€æœ‰æ•°æ®
							console.log(request.result)
						} else {
							console.log('æœªè·å¾—æ•°æ®è®°å½•')
						}
					};
				}
			},

			// æ ¹æ®ç´¢å¼•æŸ¥å€¼(è‹¥æ•°æ®ä¸å­˜åœ¨ï¼Œè¿”å›ä¸€ä¸ª[]æ•°ç»„)
			// å¯¹è±¡ä»“åº“ï¼ˆè¡¨åï¼‰
			searchFromIndex(objectStoreName, index, data) { //index ç´¢å¼•key  dataç»“æœ
				var this_ = this;
				if (this_.db != null) {
					console.log(this_.db)

					// æ‰§è¡Œäº‹åŠ¡ï¼Œä»å¯¹è±¡ä»“åº“ï¼ˆè¡¨ï¼‰ä¸­è·å–æ‰€æœ‰æ•°æ®
					var request = this_.db.transaction([objectStoreName], 'readonly')
						.objectStore(objectStoreName).index(index).getAll(data)

					// æ•°æ®è·å–å¤±è´¥
					request.onerror = function(event) {
						console.log('äº‹åŠ¡å¤±è´¥')
					}

					//æ•°æ®è·å–æˆåŠŸ
					request.onsuccess = function(event) {
						if (request.result) {
							// éå†æ‰“å°æ‰€æœ‰æ•°æ®
							console.log(request.result)
						} else {
							console.log('æœªè·å¾—æ•°æ®è®°å½•')
						}
					};
				}
			},


			openDB(dbname, objectStoreName, version) {
				// è·å–å½“å‰æ•°æ®åº“ç‰ˆæœ¬å·
				var version = version || 1

				// è·å–æ•°æ®åº“è¿æ¥ï¼Œè‹¥æ•°æ®åº“ä¸å­˜åœ¨ï¼Œä¼šåˆ›å»ºæ•°æ®åº“ï¼ˆå¼‚æ­¥å¤„ç†ï¼Œæ ¹æ®æƒ…å†µè‡ªåŠ¨è§¦å‘ä¸‹é¢ä¸‰ä¸ªäº‹ä»¶ï¼‰
				var request = window.indexedDB.open(dbname, version)

				// è·å–æ•°æ®åº“è¿æ¥å¤±è´¥
				request.onerror = function(event) {
					console.log('IndexedDBæ•°æ®åº“æ‰“å¼€é”™è¯¯')
				}

				// è·å–æ•°æ®åº“è¿æ¥æˆåŠŸ 

				var this_ = this;

				request.onsuccess = function(event, callback) {
					console.log(event, '333333')
					this_.db = event.target.result;
					if (callback && (typeof callback === 'function')) {
						callback(this_.db)
					}
					if (this_.db != null) {
						console.log('æ•°æ®åº“æ‰“å¼€æˆåŠŸ')
					}
				}

				// åˆ›å»ºæ–°çš„å‚¨å­˜ç©ºé—´ï¼ˆå½“ç¬¬ä¸€æ¬¡åˆ›å»ºæ•°æ®åº“ã€æˆ–è€…æ•°æ®åº“ç‰ˆæœ¬å·å˜åŒ–æ—¶ä¼šè§¦å‘ï¼‰
				request.onupgradeneeded = function(event) {
					console.log('æ•°æ®åº“ç‰ˆæœ¬å˜åŒ–')
					console.log('åˆ›å»ºæ•°æ®åº“' + dbname)
					// æ‹¿åˆ°æ•°æ®åº“è¿æ¥çš„ç»“æœå¯¹è±¡
					this_.db = event.target.result;

					// åˆ¤æ–­å½“å‰æ•°æ®åº“ä¸­è¡¨ï¼ˆå¯¹è±¡ä»“åº“ï¼‰æ˜¯å¦å­˜åœ¨ï¼ˆæ³¨æ„æ­¤å¤„æ˜¯æ•°æ®åº“çš„è¡¨åï¼Œä¸æ˜¯æ•°æ®åº“åï¼‰
					if (!this_.db.objectStoreNames.contains(objectStoreName)) {
						// åˆ›å»ºå¯¹è±¡ä»“åº“ï¼Œå¹¶è®¾ç½®ä¸»é”®è‡ªå¢
						var objectStore = this_.db.createObjectStore(objectStoreName, {
							keyPath: 'id',
							autoIncrement: true
						})

						// åˆ›å»ºç´¢å¼•ï¼ˆæ ¹æ®éœ€è¦åˆ›å»ºï¼‰
						objectStore.createIndex('name', 'name', {
							unique: false
						})

						objectStore.createIndex('age', 'age', {
							unique: false
						})

						objectStore.createIndex('sex', 'sex', {
							unique: false
						})
					}
				}
			}
		}
	}
</script>

<style>
	.aaa:empty {
		width: 200px;
		height: 200px;
		background: skyblue;
	}

	.aaa:empty::after {
		content: 'dd43ddd';
	}

	.imgsa {
		width: 600px;
		height: 600px;
		background: no-repeat center / contain;
		background-image: -webkit-cross-fade(url(../../staticFile/img/threejs65tree.png), url(../../staticFile/img/timg.jpg), 50%);
	}
</style>
